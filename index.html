<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blutdruck ‚Äì G√§steseite</title>

<style>
/* -------- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ -------- */
.table-wrapper {
    overflow-x: auto;
    width: 100%;
    -webkit-overflow-scrolling: touch;
    margin-top: 15px;
}

table {
    width: 950px;
    border-collapse: collapse;
    margin-top: 20px;
    font-family: Arial;
    font-size: 17px;
}

th {
    background-color: #e3eaf3;
    color: #2a3b55;
    padding: 10px;
    border: 1px solid #c5d1df;
}

td {
    padding: 10px;
    border: 1px solid #c5d1df;
    text-align: center;
    background-color: #f8fafc;
    white-space: pre-line;
}

tr:nth-child(even) td {
    background-color: #f0f4f8;
}

button {
    margin-top: 10px;
    padding: 10px 18px;
    background-color: #2a3b55;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 15px;
}

button:hover {
    background-color: #1e2c40;
}

.btn-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 15px;
}

.bp-chart-container {
    width: 100%;
    overflow-x: auto;
    margin: 25px auto;
}

canvas {
    width: 100% !important;
    height: 260px !important;
}

@media print {
    header, .header, .site-header, .logo, nav, .navbar,
    img[alt="logo"], img[src*="logo"] { display: none !important; }
    h1, h2, h3 { display: none !important; }
    #headerBlock h1 { display: block !important; font-size: 18px !important; }
    #guestNameLine, #guestDobLine { display: block !important; font-size: 12px !important; }
    #headerExplain { display: none !important; }
    .bp-chart-container { display: none !important; }
    table { width: 100% !important; font-size: 11px !important; }
    th, td { padding: 3px !important; border: 1px solid #777 !important; }
    .btn-row, #langDE, #langRU { display: none !important; }
    body { margin: 0 !important; padding: 0 !important; }
}
</style>
</head>
<body>

<div id="guestContent">

    <div style="text-align:center; margin-top:15px; font-family:Arial;">
        <button id="langDE">üá©üá™ Deutsch</button>
        <button id="langRU">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
    </div>

    <div id="headerBlock"
         style="text-align:center; margin-top:20px; font-family:Arial; color:#2a3b55; max-width:90%; margin-left:auto; margin-right:auto;">
    </div>

    <div class="bp-chart-container">
        <canvas id="bpChart"></canvas>
    </div>

    <div class="table-wrapper">
        <table id="bpTable">
            <thead id="tableHead"></thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="btn-row" id="buttonRow"></div>

</div>



<!-- =================== CHART.JS LITE (OFFLINE) ===================== -->
<script>
class SimpleChart {
    constructor(ctx, config) {
        this.ctx = ctx;
        this.data = config.data;
        this.options = config.options || {};
        this.draw();
    }

    update() { this.draw(); }

    draw() {
        const ctx = this.ctx;
        const w = ctx.canvas.width;
        const h = ctx.canvas.height;

        ctx.clearRect(0, 0, w, h);

        let labels = this.data.labels;
        if (!labels.length) return;

        let maxY = 0;
        let minY = 9999;

        for (let ds of this.data.datasets) {
            for (let v of ds.data) {
                if (v > maxY) maxY = v;
                if (v < minY) minY = v;
            }
        }

        if (minY === maxY) maxY += 1;

        let leftPad = 40;
        let bottomPad = 30;

        let chartW = w - leftPad - 10;
        let chartH = h - bottomPad - 10;

        ctx.strokeStyle = "#444";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(leftPad, 10);
        ctx.lineTo(leftPad, chartH + 10);
        ctx.lineTo(chartW + leftPad, chartH + 10);
        ctx.stroke();

        const count = labels.length;
        const stepX = chartW / Math.max(1, count - 1);

        function getY(v) {
            return chartH + 10 - ((v - minY) / (maxY - minY)) * chartH;
        }

        for (let ds of this.data.datasets) {
            ctx.strokeStyle = ds.borderColor;
            ctx.lineWidth = 2;
            ctx.beginPath();

            ds.data.forEach((v, i) => {
                let x = leftPad + i * stepX;
                let y = getY(v);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });

            ctx.stroke();

            ctx.fillStyle = ds.borderColor;
            ds.data.forEach((v, i) => {
                let x = leftPad + i * stepX;
                let y = getY(v);
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
        }
    }
}

window.Chart = SimpleChart;
</script>



<!-- ======================== –û–°–ù–û–í–ù–û–ô JS ========================= -->
<script>
/* --- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ --- */
const _mem = {};
function safeGet(k) { try { return localStorage.getItem(k); } catch(e) { return _mem[k]||null; } }
function safeSet(k,v){ try { localStorage.setItem(k,v);} catch(e){ _mem[k]=v; } }
function safeDel(k){ try { localStorage.removeItem(k);} catch(e){ delete _mem[k]; } }

/* --- –Ø–∑—ã–∫–∏ --- */
const LANG = {
    de:{ex:"Jeder Gast kann hier sein eigenes Blutdrucktagebuch f√ºhren.\nDie Daten werden NUR lokal gespeichert.",
        head:`<tr><th>Datum</th><th>Uhrzeit</th><th>Systolisch</th><th>Diastolisch</th><th>Puls</th><th>Anmerkungen</th></tr>`,
        btn:`<button onclick="setFirst()">Vorname</button>
             <button onclick="setLast()">Nachname</button>
             <button onclick="setBirth()">Geburtsdatum</button>
             <button onclick="addEntry()">Eintrag hinzuf√ºgen</button>
             <button onclick="delLast()">Letzten l√∂schen</button>
             <button onclick="delToday()">Heutige l√∂schen</button>
             <button onclick="delAll()">Alles l√∂schen</button>
             <button onclick="exportCSV()">CSV</button>
             <button onclick="window.print()">PDF</button>`,
        p:{sys:"Systolisch:",dia:"Diastolisch:",pul:"Puls:",note:"Notiz:",
           del:"Alles l√∂schen?",err:"Keine Eintr√§ge.",tod:"Heute keine Eintr√§ge.",
           f:"Vorname:",l:"Nachname:",b:"Geburtsdatum:"}},
    ru:{ex:"–ö–∞–∂–¥—ã–π –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ —Å–≤–æ–π –¥–Ω–µ–≤–Ω–∏–∫ –¥–∞–≤–ª–µ–Ω–∏—è.\n–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.",
        head:`<tr><th>–î–∞—Ç–∞</th><th>–í—Ä–µ–º—è</th><th>–°–∏—Å—Ç.</th><th>–î–∏–∞—Å—Ç.</th><th>–ü—É–ª—å—Å</th><th>–ü—Ä–∏–º.</th></tr>`,
        btn:`<button onclick="setFirst()">–ò–º—è</button>
             <button onclick="setLast()">–§–∞–º–∏–ª–∏—è</button>
             <button onclick="setBirth()">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</button>
             <button onclick="addEntry()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
             <button onclick="delLast()">–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é</button>
             <button onclick="delToday()">–£–¥–∞–ª–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ</button>
             <button onclick="delAll()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
             <button onclick="exportCSV()">CSV</button>
             <button onclick="window.print()">PDF</button>`,
        p:{sys:"–°–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ:",dia:"–î–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ:",pul:"–ü—É–ª—å—Å:",note:"–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:",
           del:"–£–¥–∞–ª–∏—Ç—å –≤—Å—ë?",err:"–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π.",tod:"–ù–µ—Ç —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏—Ö.",
           f:"–ò–º—è:",l:"–§–∞–º–∏–ª–∏—è:",b:"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:"}}
};

let lang="de";

/* --- –ö–ª—é—á–∏ --- */
const kData=()=>`data_${lang}`;
const kF=()=>`f_${lang}`;
const kL=()=>`l_${lang}`;
const kB=()=>`b_${lang}`;

function render(){
    const L=LANG[lang];
    const f=safeGet(kF())||""; const l=safeGet(kL())||""; const b=safeGet(kB())||"";
    let full=(f+" "+l).trim();

    document.getElementById("headerBlock").innerHTML=
    `<h1 style="margin:0;font-size:26px;">${full?(
        lang==="de"?"Blutdrucktagebuch ‚Äì ":"–î–Ω–µ–≤–Ω–∏–∫ –¥–∞–≤–ª–µ–Ω–∏—è ‚Äì "
    )+full:(lang==="de"?"Blutdrucktagebuch":"–î–Ω–µ–≤–Ω–∏–∫ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è")}</h1>
     ${full?`<div style="font-size:15px;">${full}</div>`:""}
     ${b?`<div style="font-size:13px;">${lang==="de"?"Geboren am: ":"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: "} ${b}</div>`:""}
     <div style="font-size:13px;white-space:pre-line;color:#56657c;margin-top:6px;">${L.ex}</div>`;

    document.getElementById("tableHead").innerHTML=L.head;
    document.getElementById("buttonRow").innerHTML=L.btn;

    load();
    updateChart();
}

document.getElementById("langDE").onclick=()=>{lang="de";render();}
document.getElementById("langRU").onclick=()=>{lang="ru";render();};

/* --- CRUD --- */
function setFirst(){ let v=prompt(LANG[lang].p.f); if(v){safeSet(kF(),v);render();}}
function setLast(){ let v=prompt(LANG[lang].p.l); if(v){safeSet(kL(),v);render();}}
function setBirth(){ let v=prompt(LANG[lang].p.b); if(v){safeSet(kB(),v);render();}}

function addEntry(){
    const P=LANG[lang].p;
    let s=prompt(P.sys); if(!s) return;
    let d=prompt(P.dia); if(!d) return;
    let p=prompt(P.pul); if(!p) return;
    let n=prompt(P.note)||"";
    let now=new Date();
    let dt=now.toLocaleDateString(lang==="de"?"de-DE":"ru-RU");
    let tm=now.toLocaleTimeString(lang==="de"?"de-DE":"ru-RU",{hour:"2-digit",minute:"2-digit"});
    let tb=document.querySelector("#bpTable tbody");
    let r=tb.insertRow();
    r.insertCell().innerText=dt;
    r.insertCell().innerText=tm;
    r.insertCell().innerText=s;
    r.insertCell().innerText=d;
    r.insertCell().innerText=p;
    r.insertCell().innerText=n;
    save();
    updateChart();
}

function delLast(){
    let rows=document.querySelector("#bpTable tbody").rows;
    if(rows.length===0){ alert(LANG[lang].p.err); return; }
    document.querySelector("#bpTable tbody").deleteRow(rows.length-1);
    save(); updateChart();
}

function delToday(){
    let tb=document.querySelector("#bpTable tbody");
    let rows=Array.from(tb.rows);
    let t=new Date().toLocaleDateString(lang==="de"?"de-DE":"ru-RU");
    let rem=false;
    rows.forEach(r=>{ if(r.cells[0].innerText===t){tb.removeChild(r);rem=true;} });
    if(!rem) alert(LANG[lang].p.tod);
    save(); updateChart();
}

function delAll(){
    if(!confirm(LANG[lang].p.del)) return;
    document.querySelector("#bpTable tbody").innerHTML="";
    safeDel(kData());
    updateChart();
}

function save(){
    let arr=[];
    document.querySelectorAll("#bpTable tbody tr").forEach(r=>{
        let t=[];
        for(let c of r.cells) t.push(c.innerText);
        arr.push(t);
    });
    safeSet(kData(),JSON.stringify(arr));
}

function load(){
    let tb=document.querySelector("#bpTable tbody");
    tb.innerHTML="";
    let d=safeGet(kData());
    if(!d) return;
    JSON.parse(d).forEach(a=>{
        let r=tb.insertRow();
        a.forEach(v=>r.insertCell().innerText=v);
    });
}

/* --- CSV --- */
function exportCSV(){
    let csv=[];
    document.querySelectorAll("#bpTable tr").forEach(r=>{
        let line=[];
        r.querySelectorAll("th,td").forEach(c=>line.push(c.innerText));
        csv.push(line.join(","));
    });
    let blob=new Blob([csv.join("\n")],{type:"text/csv"});
    let url=URL.createObjectURL(blob);
    let a=document.createElement("a");
    a.href=url;
    a.download=lang==="de"?"blutdruck_de.csv":"blutdruck_ru.csv";
    a.click();
}

/* --- Chart --- */
let ctx=document.getElementById("bpChart").getContext("2d");
let bpChart=new Chart(ctx,{
    data:{labels:[],datasets:[
        {label:"SYS",borderColor:"#ff4136",data:[]},
        {label:"DIA",borderColor:"#007bff",data:[]},
        {label:"PUL",borderColor:"#ffdc00",data:[]},
    ]}
});

function updateChart(){
    let lbl=[],s=[],d=[],p=[];
    document.querySelectorAll("#bpTable tbody tr").forEach(r=>{
        lbl.push(r.cells[0].innerText+" "+r.cells[1].innerText);
        s.push(Number(r.cells[2].innerText));
        d.push(Number(r.cells[3].innerText));
        p.push(Number(r.cells[4].innerText));
    });
    bpChart.data.labels=lbl;
    bpChart.data.datasets[0].data=s;
    bpChart.data.datasets[1].data=d;
    bpChart.data.datasets[2].data=p;
    bpChart.update();
}

/* --- Start --- */
render();
</script>

</body>
</html>
