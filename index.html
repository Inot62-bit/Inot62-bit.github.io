<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blutdruck ‚Äì G√§steseite</title>

<style>
/* -------- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ -------- */
.table-wrapper {
    overflow-x: auto;
    width: 100%;
    -webkit-overflow-scrolling: touch;
    margin-top: 15px;
}

table {
    width: 950px;
    border-collapse: collapse;
    margin-top: 20px;
    font-family: Arial;
    font-size: 17px;
}

th {
    background-color: #e3eaf3;
    color: #2a3b55;
    padding: 10px;
    border: 1px solid #c5d1df;
}

td {
    padding: 10px;
    border: 1px solid #c5d1df;
    text-align: center;
    background-color: #f8fafc;
    white-space: pre-line;
}

tr:nth-child(even) td {
    background-color: #f0f4f8;
}

button {
    margin-top: 10px;
    padding: 10px 18px;
    background-color: #2a3b55;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 15px;
}

button:hover {
    background-color: #1e2c40;
}

.btn-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 15px;
}

.bp-chart-container {
    width: 100%;
    overflow-x: auto;
    margin: 25px auto;
}

canvas {
    width: 100% !important;
    height: 260px !important;
}

/* -------- PDF (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º) -------- */
@media print {

    header, .header, .site-header, .logo, nav, .navbar,
    img[alt="logo"], img[src*="logo"] {
        display: none !important;
    }

    h1, h2, h3 {
        display: none !important;
    }

    #headerBlock h1 {
        display: block !important;
        font-size: 18px !important;
    }

    #guestNameLine,
    #guestDobLine {
        display: block !important;
        font-size: 12px !important;
    }

    #headerExplain {
        display: none !important;
    }

    .bp-chart-container {
        display: none !important;
    }

    table {
        width: 100% !important;
        font-size: 11px !important;
    }

    th, td {
        padding: 3px !important;
        border: 1px solid #777 !important;
    }

    .btn-row,
    #langDE, #langRU {
        display: none !important;
    }

    body {
        margin: 0 !important;
        padding: 0 !important;
    }
}
</style>
</head>
<body>

<!-- -------- –ö–æ–Ω—Ç–µ–Ω—Ç –≥–æ—Å—Ç–µ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -------- -->
<div id="guestContent">

    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ -->
    <div style="text-align:center; margin-top:15px; font-family:Arial;">
        <button id="langDE" style="padding:8px 15px; margin-right:10px;">üá©üá™ Deutsch</button>
        <button id="langRU" style="padding:8px 15px;">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
    </div>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –¥–∞–Ω–Ω—ã–µ –≥–æ—Å—Ç—è -->
    <div id="headerBlock"
         style="text-align:center; margin-top:20px; font-family:Arial; color:#2a3b55; max-width:90%; margin-left:auto; margin-right:auto;">
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ -->
    <div class="bp-chart-container">
        <canvas id="bpChart"></canvas>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    <div class="table-wrapper">
        <table id="bpTable">
            <thead id="tableHead"></thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="btn-row" id="buttonRow"></div>

</div> <!-- /guestContent -->

<!-- Chart.js –∏–∑ CDN (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –∏ –≤ WebView –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ======================================================
      –ë–ï–ó–û–ü–ê–°–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï (–†–ê–ë–û–¢–ê–ï–¢, –î–ê–ñ–ï –ï–°–õ–ò localStorage –ó–ê–ü–†–ï–©–Å–ù)
====================================================== */
const _memoryStore = {};

function safeGetItem(key) {
    try {
        if (typeof localStorage !== "undefined") {
            return localStorage.getItem(key);
        }
    } catch (e) {}
    return _memoryStore[key] ?? null;
}

function safeSetItem(key, value) {
    try {
        if (typeof localStorage !== "undefined") {
            localStorage.setItem(key, value);
            return;
        }
    } catch (e) {}
    _memoryStore[key] = value;
}

function safeRemoveItem(key) {
    try {
        if (typeof localStorage !== "undefined") {
            localStorage.removeItem(key);
            return;
        }
    } catch (e) {}
    delete _memoryStore[key];
}

/* -------- –¢–µ–∫—Å—Ç—ã DE / RU -------- */
const LANG = {
    de: {
        headerTitle: "",
        explain: "Jeder Gast kann hier sein eigenes Blutdrucktagebuch f√ºhren.\nDie Daten werden NUR lokal auf diesem Ger√§t gespeichert.",
        tableHead: `
            <tr>
                <th>Datum</th>
                <th>Uhrzeit</th>
                <th>Systolisch</th>
                <th>Diastolisch</th>
                <th>Puls</th>
                <th>Anmerkungen</th>
            </tr>
        `,
        buttons: `
            <button onclick="setGuestFirstName()">Vorname eingeben</button>
            <button onclick="setGuestLastName()">Nachname eingeben</button>
            <button onclick="setGuestBirthdate()">Geburtsdatum eingeben</button>
            <button onclick="addEntry()">Eintrag hinzuf√ºgen</button>
            <button onclick="deleteLast()">Letzten Eintrag l√∂schen</button>
            <button onclick="clearToday()">Heutige l√∂schen</button>
            <button onclick="clearAll()">Alles l√∂schen</button>
            <button onclick="exportCSV()">CSV exportieren</button>
            <button onclick="savePDF()">PDF speichern</button>
        `,
        prompts: {
            sys: "Systolischen Wert eingeben:",
            dia: "Diastolischen Wert eingeben:",
            pulse: "Puls eingeben:",
            note: "Notiz eingeben:",
            deleteConfirm: "Alle Eintr√§ge l√∂schen?",
            deleteError: "Keine Eintr√§ge.",
            todayEmpty: "Heute keine Eintr√§ge.",
            firstName: "Bitte Vornamen eingeben:",
            lastName: "Bitte Nachnamen eingeben:",
            birthdate: "Bitte Geburtsdatum eingeben (z.B. 12.07.1962):"
        }
    },

    ru: {
        headerTitle: "",
        explain: "–ó–¥–µ—Å—å –∫–∞–∂–¥—ã–π –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ —Å–≤–æ–π –¥–Ω–µ–≤–Ω–∏–∫ –¥–∞–≤–ª–µ–Ω–∏—è.\n–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.",
        tableHead: `
            <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–í—Ä–µ–º—è</th>
                <th>–°–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ</th>
                <th>–î–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ</th>
                <th>–ü—É–ª—å—Å</th>
                <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
            </tr>
        `,
        buttons: `
            <button onclick="setGuestFirstName()">–í–≤–µ—Å—Ç–∏ –∏–º—è</button>
            <button onclick="setGuestLastName()">–í–≤–µ—Å—Ç–∏ —Ñ–∞–º–∏–ª–∏—é</button>
            <button onclick="setGuestBirthdate()">–í–≤–µ—Å—Ç–∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è</button>
            <button onclick="addEntry()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
            <button onclick="deleteLast()">–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é</button>
            <button onclick="clearToday()">–£–¥–∞–ª–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ</button>
            <button onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
            <button onclick="exportCSV()">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
            <button onclick="savePDF()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å PDF</button>
        `,
        prompts: {
            sys: "–í–≤–µ–¥–∏—Ç–µ —Å–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ:",
            dia: "–í–≤–µ–¥–∏—Ç–µ –¥–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ:",
            pulse: "–í–≤–µ–¥–∏—Ç–µ –ø—É–ª—å—Å:",
            note: "–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ:",
            deleteConfirm: "–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏?",
            deleteError: "–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π.",
            todayEmpty: "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç.",
            firstName: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è:",
            lastName: "–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é:",
            birthdate: "–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 12.07.1962):"
        }
    }
};

let currentLang = "de";

/* ======================================================
        –•–†–ê–ù–ò–õ–ò–©–ï –î–ê–ù–ù–´–• ‚Äî –†–ê–ó–î–ï–õ–¨–ù–û –ü–û –Ø–ó–´–ö–£
====================================================== */

function getStorageKey() {
    return currentLang === "de" ? "guest_bp_data_de" : "guest_bp_data_ru";
}

function getNameKey() {
    return currentLang === "de" ? "guest_firstname_de" : "guest_firstname_ru";
}

function getLastKey() {
    return currentLang === "de" ? "guest_lastname_de" : "guest_lastname_ru";
}

function getBirthKey() {
    return currentLang === "de" ? "guest_birthdate_de" : "guest_birthdate_ru";
}

/* ======================================================
        –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –Ø–ó–´–ö–ê + –ó–ê–ì–†–£–ó–ö–ê –ü–†–û–§–ò–õ–Ø
====================================================== */

function applyLanguage() {
    const L = LANG[currentLang];

    /* –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∏–º—è/—Ñ–∞–º–∏–ª–∏—é/–¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞ */
    const first = safeGetItem(getNameKey()) || "";
    const last  = safeGetItem(getLastKey()) || "";
    const dob   = safeGetItem(getBirthKey()) || "";

    const fullName = (first + " " + last).trim();

    /* –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è */
    let dobLine = "";
    if (dob) {
        dobLine = currentLang === "de"
            ? `<div id="guestDobLine" style="font-size:13px; margin-top:2px;">Geboren am: ${dob}</div>`
            : `<div id="guestDobLine" style="font-size:13px; margin-top:2px;">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: ${dob}</div>`;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
    let titleText = "";

    if (fullName) {
        titleText = currentLang === "de"
            ? `Blutdrucktagebuch ‚Äì ${fullName}`
            : `–î–Ω–µ–≤–Ω–∏–∫ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è ‚Äì ${fullName}`;
    } else {
        titleText = currentLang === "de"
            ? "Blutdrucktagebuch"
            : "–î–Ω–µ–≤–Ω–∏–∫ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è";
    }

    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç */
    const explainHtml = `
        <div id="headerExplain"
             style="font-size:13px; margin-top:6px; color:#56657c; white-space:pre-line;">
            ${L.explain}
        </div>
    `;

    /* –û–±–Ω–æ–≤–∏—Ç—å HTML —à–∞–ø–∫–∏ */
    document.getElementById("headerBlock").innerHTML = `
        <h1 style="margin:0; font-size:26px; font-weight:bold;">${titleText}</h1>
        ${fullName ? `<div id="guestNameLine" style="font-size:15px;">${fullName}</div>` : ""}
        ${dobLine}
        ${explainHtml}
    `;

    /* –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É */
    document.getElementById("tableHead").innerHTML = L.tableHead;

    /* –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ */
    document.getElementById("buttonRow").innerHTML = L.buttons;

    /* –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–ø–∏—Å–∏ –¢–û–õ–¨–ö–û —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞ */
    loadFromLocal();

    /* –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ */
    updateChart();
}

/* ======================================================
        –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞
====================================================== */

document.getElementById("langDE").onclick = () => {
    currentLang = "de";
    applyLanguage();
};

document.getElementById("langRU").onclick = () => {
    currentLang = "ru";
    applyLanguage();
};

/* ======================================================
          –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
====================================================== */

function saveToLocal() {
    let rows = document.querySelector("#bpTable tbody").rows;
    let data = [];

    for (let r of rows) {
        data.push([
            r.cells[0].innerText, // –¥–∞—Ç–∞
            r.cells[1].innerText, // –≤—Ä–µ–º—è
            r.cells[2].innerText, // —Å–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ
            r.cells[3].innerText, // –¥–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ
            r.cells[4].innerText, // –ø—É–ª—å—Å
            r.cells[5].innerText  // –ø—Ä–∏–º–µ—á–∞–Ω–∏—è
        ]);
    }

    safeSetItem(getStorageKey(), JSON.stringify(data));
}

/* ======================================================
          –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
====================================================== */

function loadFromLocal() {
    let saved = safeGetItem(getStorageKey());
    let body = document.querySelector("#bpTable tbody");

    body.innerHTML = ""; // –û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π

    if (!saved) return;

    JSON.parse(saved).forEach(row => {
        let r = body.insertRow();
        for (let i = 0; i < row.length; i++) {
            r.insertCell(i).innerText = row[i];
        }
    });
}

/* ======================================================
          –í–≤–æ–¥ –∏–º–µ–Ω–∏/—Ñ–∞–º–∏–ª–∏–∏/–¥–∞—Ç—ã
====================================================== */

function setGuestFirstName() {
    let v = prompt(LANG[currentLang].prompts.firstName);
    if (v === null) return;
    safeSetItem(getNameKey(), v.trim());
    applyLanguage();
}

function setGuestLastName() {
    let v = prompt(LANG[currentLang].prompts.lastName);
    if (v === null) return;
    safeSetItem(getLastKey(), v.trim());
    applyLanguage();
}

function setGuestBirthdate() {
    let v = prompt(LANG[currentLang].prompts.birthdate);
    if (v === null) return;
    safeSetItem(getBirthKey(), v.trim());
    applyLanguage();
}

/* ======================================================
          –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ü–ò–°–ò
====================================================== */

function addEntry() {
    const P = LANG[currentLang].prompts;

    let sys  = prompt(P.sys);   if (!sys) return;
    let dia  = prompt(P.dia);   if (!dia) return;
    let pul  = prompt(P.pulse); if (!pul) return;

    let note = prompt(P.note) || ""; // –ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ ¬´–ü—Ä–∏–º–µ—á–∞–Ω–∏—è¬ª

    let now = new Date();

    let date = now.toLocaleDateString(
        currentLang === "de" ? "de-DE" : "ru-RU"
    );

    let time = now.toLocaleTimeString(
        currentLang === "de" ? "de-DE" : "ru-RU",
        { hour: "2-digit", minute: "2-digit" }
    );

    let body = document.querySelector("#bpTable tbody");
    let r = body.insertRow();

    r.insertCell(0).innerText = date;
    r.insertCell(1).innerText = time;
    r.insertCell(2).innerText = sys;
    r.insertCell(3).innerText = dia;
    r.insertCell(4).innerText = pul;
    r.insertCell(5).innerText = note;

    saveToLocal();
    updateChart();
}

/* ======================================================
          –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å
====================================================== */

function deleteLast() {
    let rows = document.querySelector("#bpTable tbody").rows;

    if (rows.length === 0) {
        alert(LANG[currentLang].prompts.deleteError);
        return;
    }

    document.querySelector("#bpTable tbody").deleteRow(rows.length - 1);
    saveToLocal();
    updateChart();
}

/* ======================================================
          –£–¥–∞–ª–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –∑–∞–ø–∏—Å–∏
====================================================== */

function clearToday() {
    const P = LANG[currentLang].prompts;

    let today = new Date().toLocaleDateString(
        currentLang === "de" ? "de-DE" : "ru-RU"
    );

    let tbody = document.querySelector("#bpTable tbody");
    let rows  = Array.from(tbody.rows);

    let removed = false;

    rows.forEach(r => {
        if (r.cells[0].innerText === today) {
            tbody.removeChild(r);
            removed = true;
        }
    });

    if (!removed) {
        alert(P.todayEmpty);
        return;
    }

    saveToLocal();
    updateChart();
}

/* ======================================================
          –£–¥–∞–ª–∏—Ç—å –≤—Å—ë (–¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞)
====================================================== */

function clearAll() {
    if (!confirm(LANG[currentLang].prompts.deleteConfirm)) return;

    document.querySelector("#bpTable tbody").innerHTML = "";

    safeRemoveItem(getStorageKey());      // —É–¥–∞–ª–∏—Ç—å –¥–Ω–µ–≤–Ω–∏–∫
    // –ò–º—è –∏ –¥–∞—Ç–∞ –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è

    updateChart();
}

/* ======================================================
          –≠–∫—Å–ø–æ—Ä—Ç CSV
====================================================== */

function exportCSV() {
    let rows = document.querySelectorAll("#bpTable tr");
    let csv = [];

    for (let row of rows) {
        let cols = row.querySelectorAll("th, td");
        let rowData = [];
        cols.forEach(col => rowData.push(col.innerText));
        csv.push(rowData.join(","));
    }

    let blob = new Blob([csv.join("\n")], { type: "text/csv" });
    let url = URL.createObjectURL(blob);

    let a = document.createElement("a");
    a.href = url;
    a.download = currentLang === "de"
        ? "blutdruck_de.csv"
        : "blutdruck_ru.csv";

    a.click();
}

/* ======================================================
          PDF (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)
====================================================== */

function savePDF() {
    window.print();
}

/* ======================================================
          –ü–ª–∞–≥–∏–Ω —Ü–≤–µ—Ç–Ω—ã—Ö –∑–æ–Ω (—Ñ–æ–Ω –≥—Ä–∞—Ñ–∏–∫–∞)
====================================================== */
const bpBackground = {
    id: 'bpBackground',
    beforeDraw(chart) {
        const {ctx, chartArea:{left, right}, scales:{y}} = chart;

        if (!y) return;

        // –ó–µ–ª—ë–Ω–∞—è –∑–æ–Ω–∞ ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ
        ctx.fillStyle = 'rgba(120, 200, 120, 0.15)';
        ctx.fillRect(left, y.getPixelForValue(80), right-left, y.getPixelForValue(0)-y.getPixelForValue(80));

        // –ñ—ë–ª—Ç–∞—è –∑–æ–Ω–∞ ‚Äî —Å–ª–µ–≥–∫–∞ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–µ
        ctx.fillStyle = 'rgba(255, 215, 0, 0.18)';
        ctx.fillRect(left, y.getPixelForValue(90), right-left, y.getPixelForValue(80)-y.getPixelForValue(90));

        // –ö—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞ ‚Äî –≤—ã—Å–æ–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ
        ctx.fillStyle = 'rgba(255, 99, 132, 0.18)';
        ctx.fillRect(left, y.getPixelForValue(200), right-left, y.getPixelForValue(90)-y.getPixelForValue(200));
    }
};

/* ======================================================
          –ì—Ä–∞—Ñ–∏–∫ Chart.js
====================================================== */
let ctx = document.getElementById('bpChart').getContext('2d');

let bpChart = new Chart(ctx, {
    type: 'line',
    plugins: [bpBackground],
    data: {
        labels: [],
        datasets: [
            {
                label: "SYS",
                data: [],
                borderColor: '#ff4136',
                backgroundColor: '#ff413640',
                pointRadius: 3,
                tension: 0.3
            },
            {
                label: "DIA",
                data: [],
                borderColor: '#007bff',
                backgroundColor: '#007bff40',
                pointRadius: 3,
                tension: 0.3
            },
            {
                label: "PUL",
                data: [],
                borderColor: '#ffdc00',
                backgroundColor: '#ffdc0040',
                pointRadius: 3,
                tension: 0.3
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                suggestedMin: 50,
                suggestedMax: 200
            }
        }
    }
});

/* ======================================================
          –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
====================================================== */
function updateChart() {
    let rows = document.querySelector("#bpTable tbody").rows;

    let labels = [];
    let sys = [];
    let dia = [];
    let pul = [];

    for (let r of rows) {
        labels.push(r.cells[0].innerText + " " + r.cells[1].innerText);
        sys.push(Number(r.cells[2].innerText));
        dia.push(Number(r.cells[3].innerText));
        pul.push(Number(r.cells[4].innerText));
    }

    bpChart.data.labels = labels;
    bpChart.data.datasets[0].data = sys;
    bpChart.data.datasets[1].data = dia;
    bpChart.data.datasets[2].data = pul;

    bpChart.data.datasets[0].label =
        currentLang === "de" ? "Systolisch" : "–°–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ";

    bpChart.data.datasets[1].label =
        currentLang === "de" ? "Diastolisch" : "–î–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ";

    bpChart.data.datasets[2].label =
        currentLang === "de" ? "Puls" : "–ü—É–ª—å—Å";

    bpChart.update();
}

/* ======================================================
          –ó–ê–ü–£–°–ö –ü–†–ò –û–¢–ö–†–´–¢–ò–ò
====================================================== */

try {
    applyLanguage();
    loadFromLocal();
    updateChart();
} catch (e) {
    console.log("Init error:", e);
}
</script>

</body>
</html>
