<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blutdruck ‚Äì G√§steseite</title>

<style>
.table-wrapper {
    overflow-x: auto;
    width: 100%;
    -webkit-overflow-scrolling: touch;
    margin-top: 15px;
}

table {
    width: 950px;
    border-collapse: collapse;
    margin-top: 20px;
    font-family: Arial;
    font-size: 17px;
}

th {
    background-color: #e3eaf3;
    color: #2a3b55;
    padding: 10px;
    border: 1px solid #c5d1df;
}

td {
    padding: 10px;
    border: 1px solid #c5d1df;
    text-align: center;
    background-color: #f8fafc;
    white-space: pre-line;
}

tr:nth-child(even) td {
    background-color: #f0f4f8;
}

button {
    margin-top: 10px;
    padding: 10px 18px;
    background-color: #2a3b55;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 15px;
}

button:hover {
    background-color: #1e2c40;
}

.btn-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 15px;
}

.bp-chart-container {
    width: 100%;
    overflow-x: auto;
    margin: 25px auto;
}

canvas {
    width: 100% !important;
    height: auto !important;
}

@media print {
    header, .header, .site-header, .logo, nav, .navbar {
        display: none !important;
    }

    h1, h2, h3 {
        display: none !important;
    }

    #headerBlock h1 {
        display: block !important;
        font-size: 18px !important;
    }

    #guestNameLine,
    #guestDobLine {
        display: block !important;
        font-size: 12px !important;
    }

    #bpChart,
    #headerExplain {
        display: none !important;
    }

    table {
        width: 100% !important;
        font-size: 11px !important;
    }

    th, td {
        padding: 3px !important;
        border: 1px solid #777 !important;
    }

    .btn-row,
    #langDE, #langRU {
        display: none !important;
    }

    body {
        margin: 0 !important;
        padding: 0 !important;
    }
}
</style>
</head>
<body>

<div id="guestContent">

<div style="text-align:center; margin-top:15px; font-family:Arial;">
    <button id="langDE" style="padding:8px 15px; margin-right:10px;">üá©üá™ Deutsch</button>
    <button id="langRU" style="padding:8px 15px;">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
</div>

<div id="headerBlock"
     style="text-align:center; margin-top:20px; font-family:Arial; color:#2a3b55; max-width:90%; margin-left:auto; margin-right:auto;">
</div>

<div class="bp-chart-container">
    <canvas id="bpChart"></canvas>
</div>

<div class="table-wrapper">
    <table id="bpTable">
        <thead id="tableHead"></thead>
        <tbody></tbody>
    </table>
</div>

<div class="btn-row" id="buttonRow"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
<div class="btn-row">
    <button onclick="addEntry()">Eintrag hinzuf√ºgen</button>
    <button onclick="deleteLast()">Letzten Eintrag l√∂schen</button>
    <button onclick="clearToday()">Heutige l√∂schen</button>
    <button onclick="clearAll()">Alles l√∂schen</button>
    <button onclick="exportCSV()">CSV exportieren</button>
    <button onclick="window.print()">PDF speichern</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* Speicherung */
function saveLocal() {
    let rows = document.querySelector("#bpTable tbody").rows;
    let data = [];
    for (let r of rows) {
        data.push([
            r.cells[0].innerText,
            r.cells[1].innerText,
            r.cells[2].innerText,
            r.cells[3].innerText,
            r.cells[4].innerText,
            r.cells[5].innerText
        ]);
    }
    localStorage.setItem("bp_data", JSON.stringify(data));
}

/* Laden */
function loadLocal() {
    let saved = localStorage.getItem("bp_data");
    let body = document.querySelector("#bpTable tbody");
    body.innerHTML = "";
    if (!saved) return;

    JSON.parse(saved).forEach(row => {
        let r = body.insertRow();
        row.forEach(v => r.insertCell().innerText = v);
    });
}

/* Eintrag */
function addEntry() {
    let sys = prompt("Systolisch:");
    if (!sys) return;
    let dia = prompt("Diastolisch:");
    if (!dia) return;
    let pul = prompt("Puls:");
    if (!pul) return;
    let note = prompt("Notiz:") || "";

    let now = new Date();
    let date = now.toLocaleDateString("de-DE");
    let time = now.toLocaleTimeString("de-DE", {hour:"2-digit", minute:"2-digit"});

    let r = document.querySelector("#bpTable tbody").insertRow();
    r.insertCell().innerText = date;
    r.insertCell().innerText = time;
    r.insertCell().innerText = sys;
    r.insertCell().innerText = dia;
    r.insertCell().innerText = pul;
    r.insertCell().innerText = note;

    saveLocal();
    updateChart();
}

/* L√∂schen letzte */
function deleteLast() {
    let rows = document.querySelector("#bpTable tbody").rows;
    if (rows.length === 0) return alert("Keine Eintr√§ge.");
    document.querySelector("#bpTable tbody").deleteRow(rows.length - 1);
    saveLocal();
    updateChart();
}

/* L√∂schen heutige */
function clearToday() {
    let today = new Date().toLocaleDateString("de-DE");
    let tbody = document.querySelector("#bpTable tbody");
    let rows = Array.from(tbody.rows);
    let removed = false;

    rows.forEach(r => {
        if (r.cells[0].innerText === today) {
            tbody.removeChild(r);
            removed = true;
        }
    });

    if (!removed) return alert("Heute keine Eintr√§ge.");
    saveLocal();
    updateChart();
}

/* Alles l√∂schen */
function clearAll() {
    if (!confirm("Alles l√∂schen?")) return;
    document.querySelector("#bpTable tbody").innerHTML = "";
    localStorage.removeItem("bp_data");
    updateChart();
}

/* CSV */
function exportCSV() {
    let rows = document.querySelectorAll("#bpTable tr");
    let csv = [];
    rows.forEach(r => {
        let cols = [...r.querySelectorAll("th,td")].map(c => c.innerText);
        csv.push(cols.join(","));
    });

    let blob = new Blob([csv.join("\n")], {type:"text/csv"});
    let url = URL.createObjectURL(blob);

    let a = document.createElement("a");
    a.href = url;
    a.download = "blutdruck.csv";
    a.click();
}

/* Chart.js */
let ctx = document.getElementById('bpChart').getContext('2d');
let bpChart = new Chart(ctx, {
    type: 'line',
    data: { labels: [], datasets: [
        {label:"SYS",data:[],borderColor:'#ff4136',backgroundColor:'#ff413640',pointRadius:3,tension:0.3},
        {label:"DIA",data:[],borderColor:'#007bff',backgroundColor:'#007bff40',pointRadius:3,tension:0.3},
        {label:"PUL",data:[],borderColor:'#ffdc00',backgroundColor:'#ffdc0040',pointRadius:3,tension:0.3}
    ]},
    options:{responsive:true,maintainAspectRatio:false}
});

/* Update Chart */
function updateChart() {
    let rows = document.querySelector("#bpTable tbody").rows;
    let labels=[], sys=[], dia=[], pul=[];

    for (let r of rows) {
        labels.push(r.cells[0].innerText + " " + r.cells[1].innerText);
        sys.push(Number(r.cells[2].innerText));
        dia.push(Number(r.cells[3].innerText));
        pul.push(Number(r.cells[4].innerText));
    }

    bpChart.data.labels = labels;
    bpChart.data.datasets[0].data = sys;
    bpChart.data.datasets[1].data = dia;
    bpChart.data.datasets[2].data = pul;
    bpChart.update();
}

/* Start */
loadLocal();
updateChart();
</script>

</body>
</html>
