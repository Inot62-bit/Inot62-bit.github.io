<!DOCTYPE html>
<html lang="de">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blutdrucktagebuch / –î–Ω–µ–≤–Ω–∏–∫ –¥–∞–≤–ª–µ–Ω–∏—è</title>

<style>
body {
    margin: 0;
    padding: 20px;
    font-family: Arial, sans-serif;
    background: #f4f6fa;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
h1 {
    text-align: center;
    color: #23395d;
    margin-bottom: 10px;
}

/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ */
.lang-row {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
}
.lang-row button {
    padding: 10px 18px;
    font-size: 16px;
    background: #23395d;
    color: #fff;
    border: none;
    border-radius: 8px;
}
.lang-row button:hover {
    background: #152233;
}

/* –¢–∞–±–ª–∏—Ü–∞ */
.table-wrapper {
    overflow-x: auto;
    margin-top: 20px;
}
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 16px;
}
th, td {
    padding: 10px;
    border: 1px solid #cdd6e1;
}
th {
    background: #e9eff7;
}
tr:nth-child(even) td {
    background: #f5f8fc;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn-row {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
}
button.action {
    padding: 10px 16px;
    border: none;
    background: #23395d;
    color: white;
    border-radius: 6px;
    font-size: 15px;
}
button.action:hover {
    background: #152233;
}

/* –ì—Ä–∞—Ñ–∏–∫ */
.chart-container {
    width: 100%;
    max-width: 900px;
    height: 320px;
    margin: 30px auto;
}

/* PDF */
@media print {
    .btn-row, .lang-row, h1 {
        display: none;
    }
    table {
        font-size: 11px !important;
    }
}
</style>
</head>

<body>

<h1 id="title">Blutdrucktagebuch</h1>

<!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ -->
<div class="lang-row">
    <button onclick="setLang('de')">üá©üá™ Deutsch</button>
    <button onclick="setLang('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
</div>

<!-- –ì—Ä–∞—Ñ–∏–∫ -->
<div class="chart-container">
    <canvas id="bpChart"></canvas>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ -->
<div class="table-wrapper">
<table id="bpTable">
    <thead id="thead"></thead>
    <tbody></tbody>
</table>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ -->
<div class="btn-row">
    <button class="action" onclick="addEntry()" id="btnAdd">Eintrag hinzuf√ºgen</button>
    <button class="action" onclick="deleteLast()" id="btnDeleteLast">Letzten l√∂schen</button>
    <button class="action" onclick="clearAll()" id="btnClearAll">Alles l√∂schen</button>
    <button class="action" onclick="exportCSV()" id="btnCSV">CSV exportieren</button>
    <button class="action" onclick="window.print()" id="btnPDF">PDF speichern</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ======== –Ø–ó–´–ö–ò ======== */
const LANG = {
    de: {
        title: "Blutdrucktagebuch",
        sys: "Systolisch",
        dia: "Diastolisch",
        pulse: "Puls",
        note: "Notiz",
        tableHead: ["Datum", "Uhrzeit", "Systolisch", "Diastolisch", "Puls", "Notiz"],
        prompts: {
            sys: "Systolisch eingeben:",
            dia: "Diastolisch eingeben:",
            pulse: "Puls eingeben:",
            note: "Notiz eingeben:"
        },
        buttons: {
            add: "Eintrag hinzuf√ºgen",
            delLast: "Letzten l√∂schen",
            clearAll: "Alles l√∂schen",
            csv: "CSV exportieren",
            pdf: "PDF speichern"
        }
    },

    ru: {
        title: "–î–Ω–µ–≤–Ω–∏–∫ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è",
        sys: "–°–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ",
        dia: "–î–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ",
        pulse: "–ü—É–ª—å—Å",
        note: "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ",
        tableHead: ["–î–∞—Ç–∞", "–í—Ä–µ–º—è", "–°–∏—Å—Ç–æ–ª–∏—á.", "–î–∏–∞—Å—Ç–æ–ª–∏—á.", "–ü—É–ª—å—Å", "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ"],
        prompts: {
            sys: "–í–≤–µ–¥–∏—Ç–µ —Å–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ:",
            dia: "–í–≤–µ–¥–∏—Ç–µ –¥–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ:",
            pulse: "–í–≤–µ–¥–∏—Ç–µ –ø—É–ª—å—Å:",
            note: "–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ:"
        },
        buttons: {
            add: "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å",
            delLast: "–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é",
            clearAll: "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë",
            csv: "–≠–∫—Å–ø–æ—Ä—Ç CSV",
            pdf: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å PDF"
        }
    }
};

let currentLang = "de";
let storageKey = "bp_de";

/* ======== –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ ======== */
function setLang(l) {
    currentLang = l;
    storageKey = (l === "de") ? "bp_de" : "bp_ru";

    const L = LANG[l];

    document.getElementById("title").innerText = L.title;

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã */
    document.getElementById("thead").innerHTML =
        "<tr>" + L.tableHead.map(t => `<th>${t}</th>`).join("") + "</tr>";

    /* –ö–Ω–æ–ø–∫–∏ */
    document.getElementById("btnAdd").innerText = L.buttons.add;
    document.getElementById("btnDeleteLast").innerText = L.buttons.delLast;
    document.getElementById("btnClearAll").innerText = L.buttons.clearAll;
    document.getElementById("btnCSV").innerText = L.buttons.csv;
    document.getElementById("btnPDF").innerText = L.buttons.pdf;

    loadLocal();
    updateChart();
}

/* ======== –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ======== */
function saveLocal() {
    let rows = document.querySelector("#bpTable tbody").rows;
    let arr = [];

    for (let r of rows) {
        arr.push([
            r.cells[0].innerText,
            r.cells[1].innerText,
            r.cells[2].innerText,
            r.cells[3].innerText,
            r.cells[4].innerText,
            r.cells[5].innerText
        ]);
    }

    localStorage.setItem(storageKey, JSON.stringify(arr));
}

/* ======== –ó–∞–≥—Ä—É–∑–∫–∞ ======== */
function loadLocal() {
    let data = localStorage.getItem(storageKey);
    let tbody = document.querySelector("#bpTable tbody");
    tbody.innerHTML = "";

    if (!data) return;

    JSON.parse(data).forEach(row => {
        let r = tbody.insertRow();
        row.forEach(v => r.insertCell().innerText = v);
    });
}

/* ======== –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å ======== */
function addEntry() {
    const P = LANG[currentLang].prompts;

    let sys = prompt(P.sys); if (!sys) return;
    let dia = prompt(P.dia); if (!dia) return;
    let pulse = prompt(P.pulse); if (!pulse) return;
    let note = prompt(P.note) || "";

    let now = new Date();
    let date = now.toLocaleDateString(currentLang === "de" ? "de-DE" : "ru-RU");
    let time = now.toLocaleTimeString(currentLang === "de" ? "de-DE" : "ru-RU", {hour:"2-digit", minute:"2-digit"});

    let r = document.querySelector("#bpTable tbody").insertRow();
    r.insertCell().innerText = date;
    r.insertCell().innerText = time;
    r.insertCell().innerText = sys;
    r.insertCell().innerText = dia;
    r.insertCell().innerText = pulse;
    r.insertCell().innerText = note;

    saveLocal();
    updateChart();
}

/* ======== –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é ======== */
function deleteLast() {
    let rows = document.querySelector("#bpTable tbody").rows;
    if (rows.length === 0) return;
    document.querySelector("#bpTable tbody").deleteRow(rows.length - 1);
    saveLocal();
    updateChart();
}

/* ======== –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë ======== */
function clearAll() {
    if (!confirm(currentLang === "de" ? "Alles l√∂schen?" : "–£–¥–∞–ª–∏—Ç—å –≤—Å—ë?")) return;
    document.querySelector("#bpTable tbody").innerHTML = "";
    localStorage.removeItem(storageKey);
    updateChart();
}

/* ======== CSV ======== */
function exportCSV() {
    let rows = document.querySelectorAll("#bpTable tr");
    let csv = [];

    rows.forEach(r => {
        let cols = [...r.querySelectorAll("th,td")].map(c => c.innerText);
        csv.push(cols.join(","));
    });

    let blob = new Blob([csv.join("\n")], {type:"text/csv"});
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = (currentLang === "de") ? "blutdruck.csv" : "davlenie.csv";
    a.click();
}

/* ======== –ì—Ä–∞—Ñ–∏–∫ ======== */
let ctx = document.getElementById("bpChart").getContext("2d");
let chart = new Chart(ctx, {
    type: "line",
    data: {
        labels: [],
        datasets: [
            { label:"SYS", data:[], borderColor:"#e74c3c", tension:0.3 },
            { label:"DIA", data:[], borderColor:"#3498db", tension:0.3 },
            { label:"PUL", data:[], borderColor:"#f1c40f", tension:0.3 }
        ]
    },
    options: { responsive:true, maintainAspectRatio:false }
});

/* ======== –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ ======== */
function updateChart() {
    let rows = document.querySelector("#bpTable tbody").rows;

    let labels = [];
    let sys = [];
    let dia = [];
    let pulse = [];

    for (let r of rows) {
        labels.push(r.cells[0].innerText + " " + r.cells[1].innerText);
        sys.push(+r.cells[2].innerText);
        dia.push(+r.cells[3].innerText);
        pulse.push(+r.cells[4].innerText);
    }

    chart.data.labels = labels;
    chart.data.datasets[0].data = sys;
    chart.data.datasets[1].data = dia;
    chart.data.datasets[2].data = pulse;

    chart.data.datasets[0].label = LANG[currentLang].sys;
    chart.data.datasets[1].label = LANG[currentLang].dia;
    chart.data.datasets[2].label = LANG[currentLang].pulse;

    chart.update();
}

/* ======== –°—Ç–∞—Ä—Ç ======== */
setLang("de");
</script>

</body>
</html>
