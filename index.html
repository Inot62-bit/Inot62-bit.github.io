<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blutdruck ‚Äì G√§steseite</title>

<style>
.table-wrapper {
    overflow-x: auto;
    width: 100%;
    -webkit-overflow-scrolling: touch;
    margin-top: 15px;
}

table {
    width: 950px;
    border-collapse: collapse;
    margin-top: 20px;
    font-family: Arial;
    font-size: 17px;
}

th {
    background-color: #e3eaf3;
    color: #2a3b55;
    padding: 10px;
    border: 1px solid #c5d1df;
}

td {
    padding: 10px;
    border: 1px solid #c5d1df;
    text-align: center;
    background-color: #f8fafc;
    white-space: pre-line;
}

tr:nth-child(even) td {
    background-color: #f0f4f8;
}

button {
    margin-top: 10px;
    padding: 10px 18px;
    background-color: #2a3b55;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 15px;
}

button:hover {
    background-color: #1e2c40;
}

.btn-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 15px;
}

.bp-chart-container {
    width: 100%;
    overflow-x: auto;
    margin: 25px auto;
}

canvas {
    width: 100% !important;
    height: auto !important;
}

@media print {
    header, .header, .site-header, .logo, nav, .navbar {
        display: none !important;
    }

    h1, h2, h3 {
        display: none !important;
    }

    #headerBlock h1 {
        display: block !important;
        font-size: 18px !important;
    }

    #guestNameLine,
    #guestDobLine {
        display: block !important;
        font-size: 12px !important;
    }

    #bpChart,
    #headerExplain {
        display: none !important;
    }

    table {
        width: 100% !important;
        font-size: 11px !important;
    }

    th, td {
        padding: 3px !important;
        border: 1px solid #777 !important;
    }

    .btn-row,
    #langDE, #langRU {
        display: none !important;
    }

    body {
        margin: 0 !important;
        padding: 0 !important;
    }
}
</style>
</head>
<body>

<div id="guestContent">

<div style="text-align:center; margin-top:15px; font-family:Arial;">
    <button id="langDE" style="padding:8px 15px; margin-right:10px;">üá©üá™ Deutsch</button>
    <button id="langRU" style="padding:8px 15px;">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
</div>

<div id="headerBlock"
     style="text-align:center; margin-top:20px; font-family:Arial; color:#2a3b55; max-width:90%; margin-left:auto; margin-right:auto;">
</div>

<div class="bp-chart-container">
    <canvas id="bpChart"></canvas>
</div>

<div class="table-wrapper">
    <table id="bpTable">
        <thead id="tableHead"></thead>
        <tbody></tbody>
    </table>
</div>

<div class="btn-row" id="buttonRow"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ===== –¢–µ–∫—Å—Ç—ã –¥–ª—è DE –∏ RU ===== */
const LANG = {
    de: {
        headerTitle: "Blutdruck ‚Äì G√§steseite",
        explain: "Hier k√∂nnen G√§ste ihr Blutdrucktagebuch f√ºhren.\nDie Daten werden nur lokal gespeichert.",
        tableHead: `
            <tr>
                <th>Datum</th>
                <th>Uhrzeit</th>
                <th>Systolisch</th>
                <th>Diastolisch</th>
                <th>Puls</th>
                <th>Notiz</th>
            </tr>
        `,
        buttons: `
            <button onclick="setFirstName()">Vorname</button>
            <button onclick="setLastName()">Nachname</button>
            <button onclick="setBirthdate()">Geburtsdatum</button>
            <button onclick="addEntry()">Eintrag hinzuf√ºgen</button>
            <button onclick="deleteLast()">Letzten l√∂schen</button>
            <button onclick="clearAll()">Alles l√∂schen</button>
            <button onclick="exportCSV()">CSV exportieren</button>
            <button onclick="savePDF()">PDF speichern</button>
        `,
        prompts: {
            first: "Vorname eingeben:",
            last: "Nachname eingeben:",
            birth: "Geburtsdatum eingeben (z.B. 12.07.1965):",
            sys: "Systolisch:",
            dia: "Diastolisch:",
            pulse: "Puls:",
            note: "Notiz:",
            deleteConfirm: "Alle Eintr√§ge l√∂schen?",
            deleteError: "Keine Eintr√§ge."
        }
    },

    ru: {
        headerTitle: "–î–Ω–µ–≤–Ω–∏–∫ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è",
        explain: "–ó–¥–µ—Å—å –∫–∞–∂–¥—ã–π –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ —Å–≤–æ–π –¥–Ω–µ–≤–Ω–∏–∫. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.",
        tableHead: `
            <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–í—Ä–µ–º—è</th>
                <th>–°–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ</th>
                <th>–î–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ</th>
                <th>–ü—É–ª—å—Å</th>
                <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
            </tr>
        `,
        buttons: `
            <button onclick="setFirstName()">–ò–º—è</button>
            <button onclick="setLastName()">–§–∞–º–∏–ª–∏—è</button>
            <button onclick="setBirthdate()">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</button>
            <button onclick="addEntry()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
            <button onclick="deleteLast()">–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é</button>
            <button onclick="clearAll()">–£–¥–∞–ª–∏—Ç—å –≤—Å—ë</button>
            <button onclick="exportCSV()">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
            <button onclick="savePDF()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å PDF</button>
        `,
        prompts: {
            first: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è:",
            last: "–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é:",
            birth: "–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 12.07.1965):",
            sys: "–°–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ:",
            dia: "–î–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ:",
            pulse: "–ü—É–ª—å—Å:",
            note: "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:",
            deleteConfirm: "–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏?",
            deleteError: "–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π."
        }
    }
};

let currentLang = "de";

/* ===== –ö–ª—é—á–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è (DE –∏ RU –æ—Ç–¥–µ–ª—å–Ω–æ) ===== */
function keyData() { return "bp_data_" + currentLang; }
function keyFirst() { return "bp_first_" + currentLang; }
function keyLast()  { return "bp_last_"  + currentLang; }
function keyBirth() { return "bp_birth_" + currentLang; }

/* ===== –ü—Ä–∏–º–µ–Ω–∏—Ç—å —è–∑—ã–∫ ===== */
function applyLanguage() {
    const L = LANG[currentLang];

    const first = localStorage.getItem(keyFirst()) || "";
    const last  = localStorage.getItem(keyLast())  || "";
    const birth = localStorage.getItem(keyBirth()) || "";

    document.getElementById("headerBlock").innerHTML = `
        <h1>${L.headerTitle}</h1>
        <div style="font-size:17px; margin-top:5px;">
            ${first} ${last}
        </div>
        <div style="font-size:14px; margin-top:3px;">
            ${birth ? (currentLang === "de" ? "Geboren am: " : "–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: ") + birth : ""}
        </div>
        <div id="headerExplain"
             style="white-space:pre-line; font-size:13px; margin-top:7px;">
            ${L.explain}
        </div>
    `;

    document.getElementById("tableHead").innerHTML = L.tableHead;
    document.getElementById("buttonRow").innerHTML = L.buttons;

    loadData();
}

/* ===== –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ ===== */
document.getElementById("langDE").onclick = () => { currentLang = "de"; applyLanguage(); };
document.getElementById("langRU").onclick = () => { currentLang = "ru"; applyLanguage(); };

/* ===== –ò–º—è, —Ñ–∞–º–∏–ª–∏—è, –¥–∞—Ç–∞ ===== */
function setFirstName() {
    const v = prompt(LANG[currentLang].prompts.first);
    if (v !== null) localStorage.setItem(keyFirst(), v.trim());
    applyLanguage();
}

function setLastName() {
    const v = prompt(LANG[currentLang].prompts.last);
    if (v !== null) localStorage.setItem(keyLast(), v.trim());
    applyLanguage();
}

function setBirthdate() {
    const v = prompt(LANG[currentLang].prompts.birth);
    if (v !== null) localStorage.setItem(keyBirth(), v.trim());
    applyLanguage();
}

/* ===== –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã ===== */
function saveData() {
    const rows = document.querySelector("#bpTable tbody").rows;
    let arr = [];

    for (let r of rows) {
        arr.push([
            r.cells[0].innerText,
            r.cells[1].innerText,
            r.cells[2].innerText,
            r.cells[3].innerText,
            r.cells[4].innerText,
            r.cells[5].innerText
        ]);
    }

    localStorage.setItem(keyData(), JSON.stringify(arr));
}

/* ===== –ó–∞–≥—Ä—É–∑–∫–∞ ===== */
function loadData() {
    const saved = localStorage.getItem(keyData());
    const body = document.querySelector("#bpTable tbody");

    body.innerHTML = "";
    if (!saved) return;

    JSON.parse(saved).forEach(row => {
        let r = body.insertRow();
        row.forEach(v => r.insertCell().innerText = v);
    });
}

/* ===== –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å ===== */
function addEntry() {
    const P = LANG[currentLang].prompts;

    let sys = prompt(P.sys); if (!sys) return;
    let dia = prompt(P.dia); if (!dia) return;
    let pul = prompt(P.pulse); if (!pul) return;
    let note = prompt(P.note) || "";

    const now = new Date();
    const date = now.toLocaleDateString(currentLang === "de" ? "de-DE" : "ru-RU");
    const time = now.toLocaleTimeString(currentLang === "de" ? "de-DE" : "ru-RU",
                                        {hour: "2-digit", minute: "2-digit"});

    const body = document.querySelector("#bpTable tbody");

    let r = body.insertRow();
    r.insertCell().innerText = date;
    r.insertCell().innerText = time;
    r.insertCell().innerText = sys;
    r.insertCell().innerText = dia;
    r.insertCell().innerText = pul;
    r.insertCell().innerText = note;

    saveData();
}

/* ===== –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é ===== */
function deleteLast() {
    const P = LANG[currentLang].prompts;
    const rows = document.querySelector("#bpTable tbody").rows;

    if (!rows.length) return alert(P.deleteError);

    document.querySelector("#bpTable tbody").deleteRow(rows.length - 1);
    saveData();
}

/* ===== –£–¥–∞–ª–∏—Ç—å –≤—Å—ë ===== */
function clearAll() {
    if (!confirm(LANG[currentLang].prompts.deleteConfirm)) return;
    document.querySelector("#bpTable tbody").innerHTML = "";
    localStorage.removeItem(keyData());
}

/* ===== CSV ===== */
function exportCSV() {
    let rows = document.querySelectorAll("#bpTable tr");
    let csv = [];

    rows.forEach(r => {
        let cols = [...r.querySelectorAll("th, td")].map(c => c.innerText);
        csv.push(cols.join(","));
    });

    let blob = new Blob([csv.join("\n")], { type: "text/csv" });
    let url = URL.createObjectURL(blob);

    let a = document.createElement("a");
    a.href = url;
    a.download = currentLang === "de" ? "blutdruck.csv" : "davlenie.csv";
    a.click();
}

/* ===== PDF ===== */
function savePDF() {
    window.print();
}

/* ===== –°—Ç–∞—Ä—Ç ===== */
applyLanguage();
loadData();
