<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–î–Ω–µ–≤–Ω–∏–∫ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è</title>

<style>
  :root {
    --bg: #f5f7fb;
    --card-bg: #ffffff;
    --accent: #23406b;
    --accent-soft: #e3ebff;
    --border: #d6deee;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    background: var(--bg);
  }

  .page {
    max-width: 960px;
    margin: 0 auto;
    padding: 16px;
  }

  h1 {
    text-align: center;
    font-size: 24px;
    margin: 8px 0 4px;
    color: var(--accent);
  }

  .subtitle {
    text-align: center;
    font-size: 14px;
    color: #555;
    margin-bottom: 16px;
  }

  /* –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–≤–æ–¥–∞ */
  .card {
    background: var(--card-bg);
    border-radius: 14px;
    padding: 14px 16px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    border: 1px solid var(--border);
    margin-bottom: 18px;
  }

  .card-title {
    font-size: 17px;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--accent);
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(6, minmax(0,1fr));
    gap: 8px;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    font-size: 13px;
  }

  .form-group label {
    margin-bottom: 2px;
    color: #333;
  }

  .form-group input,
  .form-group textarea {
    border-radius: 8px;
    border: 1px solid var(--border);
    padding: 6px 8px;
    font-size: 14px;
    font-family: inherit;
  }

  .form-group textarea {
    resize: vertical;
    min-height: 32px;
  }

  .buttons-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
  }

  .btn {
    border: none;
    border-radius: 999px;
    padding: 8px 16px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .btn-main {
    background: linear-gradient(135deg, #23406b, #3b6ea5);
    color: #fff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.18);
  }

  .btn-secondary {
    background: #eef2ff;
    color: #1f2a4d;
  }

  .btn-danger {
    background: #ffe8e5;
    color: #b3261e;
  }

  .btn:active {
    transform: translateY(1px);
  }

  /* –¢–∞–±–ª–∏—Ü–∞ */
  .table-wrapper {
    background: var(--card-bg);
    border-radius: 14px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    border: 1px solid var(--border);
    padding: 10px 10px 14px;
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }

  th, td {
    padding: 6px 8px;
    border-bottom: 1px solid #e1e6f2;
    text-align: left;
    white-space: nowrap;
  }

  th {
    background: var(--accent-soft);
    color: #1f2a4d;
    font-weight: 600;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  tr:last-child td {
    border-bottom: none;
  }

  .cell-note {
    white-space: normal;
    max-width: 280px;
  }

  .cell-actions button {
    border-radius: 999px;
    border: none;
    padding: 4px 10px;
    font-size: 12px;
    cursor: pointer;
    background: #ffecec;
    color: #b00020;
  }

  .stats {
    margin-top: 10px;
    font-size: 14px;
    color: #333;
  }

  .stats span {
    font-weight: 600;
    color: #1f2a4d;
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
  @media (max-width: 720px) {
    .form-grid {
      grid-template-columns: repeat(2, minmax(0,1fr));
    }
  }

  @media (max-width: 480px) {
    .page {
      padding: 10px;
    }
    h1 {
      font-size: 20px;
    }
    .form-grid {
      grid-template-columns: minmax(0,1fr);
    }
  }

  /* –ü–µ—á–∞—Ç—å –≤ PDF ‚Äî —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü–∞ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ A4 */
  @media print {
    body {
      background: #ffffff;
    }
    .card,
    .buttons-row,
    .subtitle {
      display: none !important;
    }
    .page {
      max-width: 100%;
      padding: 0;
      margin: 0;
    }
    h1 {
      margin: 0 0 6px 0;
      font-size: 18px;
      text-align: left;
    }
    .table-wrapper {
      box-shadow: none;
      border-radius: 0;
      border: none;
      padding: 0;
    }
    table {
      font-size: 11px;
    }
    th, td {
      padding: 3px 4px;
    }
    .stats {
      font-size: 11px;
      margin-top: 4px;
    }
    @page {
      size: A4;
      margin: 12mm;
    }
  }
</style>
</head>
<body>
<div class="page">
  <h1>–î–Ω–µ–≤–Ω–∏–∫ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è</h1>
  <div class="subtitle">
    –ó–∞–ø–∏—Å–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.  
    –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF –æ–¥–Ω–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º.
  </div>

  <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
  <div class="card">
    <div class="card-title">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</div>
    <div class="form-grid">
      <div class="form-group">
        <label for="date">–î–∞—Ç–∞</label>
        <input type="date" id="date">
      </div>
      <div class="form-group">
        <label for="time">–í—Ä–µ–º—è</label>
        <input type="time" id="time">
      </div>
      <div class="form-group">
        <label for="sys">–°–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ (–≤–µ—Ä—Ö–Ω–µ–µ), –º–º —Ä—Ç. —Å—Ç.</label>
        <input type="number" id="sys" inputmode="numeric" placeholder="120">
      </div>
      <div class="form-group">
        <label for="dia">–î–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ (–Ω–∏–∂–Ω–µ–µ), –º–º —Ä—Ç. —Å—Ç.</label>
        <input type="number" id="dia" inputmode="numeric" placeholder="80">
      </div>
      <div class="form-group">
        <label for="pul">–ü—É–ª—å—Å, —É–¥/–º–∏–Ω</label>
        <input type="number" id="pul" inputmode="numeric" placeholder="70">
      </div>
      <div class="form-group">
        <label for="note">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
        <textarea id="note" placeholder="–ü–æ—Å–ª–µ –ø—Ä–æ–≥—É–ª–∫–∏, —É—Ç—Ä–æ–º –Ω–∞—Ç–æ—â–∞–∫ –∏ —Ç.–¥."></textarea>
      </div>
    </div>

    <div class="buttons-row">
      <button class="btn btn-main" onclick="addEntry()">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
      </button>
      <button class="btn btn-secondary" onclick="printDiary()">
        üìÑ –°–∫–∞—á–∞—Ç—å PDF
      </button>
      <button class="btn btn-danger" onclick="clearAll()">
        üóë –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
      </button>
    </div>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ -->
  <div class="table-wrapper">
    <table id="diary-table">
      <thead>
        <tr>
          <th>–î–∞—Ç–∞</th>
          <th>–í—Ä–µ–º—è</th>
          <th>–î–∞–≤–ª–µ–Ω–∏–µ</th>
          <th>–ü—É–ª—å—Å</th>
          <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody id="diary-body">
      </tbody>
    </table>
    <div class="stats" id="stats"></div>
  </div>
</div>

<script>
  const STORAGE_KEY = "toni_bp_diary_v1";

  function pad2(n) {
    return n.toString().padStart(2, "0");
  }

  function setDefaultDateTime() {
    const now = new Date();
    document.getElementById("date").value =
      now.toISOString().slice(0, 10);

    document.getElementById("time").value =
      pad2(now.getHours()) + ":" + pad2(now.getMinutes());
  }

  function loadData() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      return JSON.parse(raw);
    } catch (e) {
      console.error(e);
      return [];
    }
  }

  function saveData(list) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
  }

  function renderTable() {
    const body = document.getElementById("diary-body");
    const stats = document.getElementById("stats");
    const list = loadData();

    // —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ/–≤—Ä–µ–º–µ–Ω–∏: —Å—Ç–∞—Ä—ã–µ —Å–≤–µ—Ä—Ö—É
    list.sort((a, b) => (a.dt > b.dt ? 1 : -1));

    body.innerHTML = "";

    let sumSys = 0, sumDia = 0, sumPul = 0, count = 0;

    list.forEach((row, index) => {
      const tr = document.createElement("tr");

      const [dateStr, timeStr] = row.dt.split("T");

      const tdDate = document.createElement("td");
      tdDate.textContent = dateStr.split("-").reverse().join(".");

      const tdTime = document.createElement("td");
      tdTime.textContent = timeStr.slice(0,5);

      const tdPress = document.createElement("td");
      tdPress.textContent = row.sys + " / " + row.dia;

      const tdPul = document.createElement("td");
      tdPul.textContent = row.pul;

      const tdNote = document.createElement("td");
      tdNote.textContent = row.note || "";
      tdNote.className = "cell-note";

      const tdActions = document.createElement("td");
      tdActions.className = "cell-actions";
      const btnDel = document.createElement("button");
      btnDel.textContent = "–£–¥–∞–ª–∏—Ç—å";
      btnDel.onclick = () => deleteEntry(index);
      tdActions.appendChild(btnDel);

      tr.appendChild(tdDate);
      tr.appendChild(tdTime);
      tr.appendChild(tdPress);
      tr.appendChild(tdPul);
      tr.appendChild(tdNote);
      tr.appendChild(tdActions);

      body.appendChild(tr);

      sumSys += Number(row.sys);
      sumDia += Number(row.dia);
      sumPul += Number(row.pul);
      count++;
    });

    if (count > 0) {
      stats.innerHTML =
        `–°—Ä–µ–¥–Ω–µ–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏: 
         <span>${Math.round(sumSys / count)} / ${Math.round(sumDia / count)} –º–º</span>, 
         –ø—É–ª—å—Å <span>${Math.round(sumPul / count)} —É–¥/–º–∏–Ω</span>. 
         –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: <span>${count}</span>.`;
    } else {
      stats.textContent = "–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é.";
    }
  }

  function addEntry() {
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    const sys = document.getElementById("sys").value.trim();
    const dia = document.getElementById("dia").value.trim();
    const pul = document.getElementById("pul").value.trim();
    const note = document.getElementById("note").value.trim();

    if (!date || !time || !sys || !dia || !pul) {
      alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞—Ç—É, –≤—Ä–µ–º—è, –¥–∞–≤–ª–µ–Ω–∏–µ –∏ –ø—É–ª—å—Å.");
      return;
    }

    const list = loadData();
    list.push({
      dt: date + "T" + time,
      sys: Number(sys),
      dia: Number(dia),
      pul: Number(pul),
      note: note
    });
    saveData(list);

    // –æ—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—è –¥–∞–≤–ª–µ–Ω–∏—è/–ø—É–ª—å—Å–∞/–∑–∞–º–µ—Ç–∫–∏
    document.getElementById("sys").value = "";
    document.getElementById("dia").value = "";
    document.getElementById("pul").value = "";
    document.getElementById("note").value = "";

    renderTable();
  }

  function deleteEntry(index) {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?")) return;
    const list = loadData();
    list.splice(index, 1);
    saveData(list);
    renderTable();
  }

  function clearAll() {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞?")) return;
    localStorage.removeItem(STORAGE_KEY);
    renderTable();
  }

  function printDiary() {
    window.print();
  }

  // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  setDefaultDateTime();
  renderTable();
</script>
</body>
</html>
